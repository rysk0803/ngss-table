!function(){"use strict";angular.module("ngssTable",[]).directive("ngssTable",function(){return{restrict:"E",scope:{keys:"=",data:"=",totalCount:"=",pagerows:"=",pagingFunc:"&"},link:function(scope,element,attr){scope.$watch("data",function(){scope.wData=scope.data,angular.isUndefined(scope.data)&&(scope.wData=[])})},templateUrl:"html/ngss-table.html"}}).directive("onFinishRepeatRender",function($timeout){return{restrict:"A",link:function(scope,element,attr){scope.$last===!0&&$timeout(function(){scope.$emit("onFinishRowsRepeat")})}}}).directive("pagination",function(){return{restrict:"E",replace:!0,link:function(scope,element,attrs){var pagingfunc,cloneData=[],pagerows=20;scope.pagerows&&(pagerows=scope.pagerows),scope.$watch("data",function(){0==scope.wData.length?(scope.page="-",scope.pages="-",scope.isFirstPage=!0,scope.isLastPage=!0):(scope.pagingFunc()?(pagingfunc=scope.pagingFunc(),scope.total=scope.totalCount):(pagingfunc=function(s,o){return cloneData.filter(function(v,i,e){return i>=s-1&&i<s+o-1})},cloneData=scope.wData,scope.total=scope.data.length),scope.page=1,scope.pages=Math.ceil(scope.total/pagerows),scope.wData=pagingfunc(pageStartCount(scope.page,pagerows),pagerows),scope.isFirstPage=!0,scope.isLastPage=!1,scope.page==scope.pages&&(scope.isLastPage=!0),setCount(scope.page,pagerows,scope.total))}),scope.first=function(){scope.page=1,scope.wData=pagingfunc(pageStartCount(scope.page,pagerows),pagerows),scope.isLastPage=!1,scope.isFirstPage=!0,setCount(scope.page,pagerows,scope.total)},scope.prev=function(){scope.page-=1,scope.wData=pagingfunc(pageStartCount(scope.page,pagerows),pagerows),1==scope.page&&(scope.isFirstPage=!0),scope.isLastPage=!1,setCount(scope.page,pagerows,scope.total)},scope.next=function(){scope.page+=1,scope.wData=pagingfunc(pageStartCount(scope.page,pagerows),pagerows),scope.page==scope.pages&&(scope.isLastPage=!0),scope.isFirstPage=!1,setCount(scope.page,pagerows,scope.total)},scope.last=function(){scope.page=scope.pages,scope.wData=pagingfunc(pageStartCount(scope.page,pagerows),pagerows),scope.isLastPage=!0,scope.isFirstPage=!1,setCount(scope.page,pagerows,scope.total)};var setCount=function(np,nr,total){scope.startCount=pageStartCount(np,nr),scope.endCount=pageEndCount(np,nr,total)},pageStartCount=function(np,nr){return 0===np?0:(np-1)*nr+1},pageEndCount=function(np,nr,total){return 0===np?0:np*nr>total?total:np*nr}},templateUrl:"html/pagination.html"}}).directive("ssTable",function(){return{restrict:"E",replace:!0,link:function(scope,element,attrs){var children=element.children("div"),header=children[0],body=children[1];body.addEventListener("scroll",function(){header.scrollLeft=body.scrollLeft}),scope.columnWidth=function(k){return{width:calcColumnWidth(k)+"px"}},scope.tableWidth=function(){return{width:calcTableWidth()+"px"}},scope.$on("onFinishRowsRepeat",function(onFinishRepeatEvent){body.scrollHeight>body.offsetHeight?header.style.width="calc(100% - 17px)":header.style.width=""});var calcStrLength=function(d){return 25*d.length},calcColumnWidth=function(k){if(k.width)return parseInt(k.width);var keyLength=calcStrLength(k.label),dataLength=0==scope.wData.length?0:calcStrLength(_.max(scope.wData,function(d){return d[k.key].length})[k.key]);return keyLength>dataLength?keyLength:dataLength},calcTableWidth=function(){var sum=0;return scope.keys.forEach(function(k){sum+=calcColumnWidth(k)}),sum}},templateUrl:"html/table.html"}})}();